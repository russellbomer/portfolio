# Quarry Sandbox Docker Compose Configuration
#
# Usage:
#   docker-compose up -d          # Start container
#   docker-compose down           # Stop container
#   docker-compose logs -f        # View logs

version: "3.8"

services:
  quarry-sandbox:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: quarry-sandbox
    restart: unless-stopped

    # Keep container running for docker exec sessions
    tty: true
    stdin_open: true

    # Network: allow outbound HTTP for web scraping
    # No ports exposed - accessed via docker exec only
    networks:
      - quarry-net

    # Volume for session outputs (downloadable files)
    volumes:
      - quarry-output:/home/quarry/output

    # Resource limits
    deploy:
      resources:
        limits:
          cpus: "0.5"
          memory: 512M
        reservations:
          cpus: "0.1"
          memory: 128M

    # Security options
    security_opt:
      - no-new-privileges:true

    # Read-only root filesystem with specific writable paths
    read_only: true
    tmpfs:
      - /tmp:size=64M,mode=1777
      - /home/quarry/.npm:size=64M,mode=755

networks:
  quarry-net:
    driver: bridge

volumes:
  quarry-output:
    driver: local
